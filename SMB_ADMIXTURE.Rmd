---
title: "SMB_GENOMICS_ADMIXTURE"
author: "Joe Gunn"
date: "10/30/2019"
output: html_document
---

# ADMIXTURE Analysis 

## Libraries needed for analysis
```{r setup, echo = FALSE, include=FALSE}
library(readxl)
library(tidyverse)
library(cowplot)
library(devtools)
library(pophelper)
```

## Genomics Metadata
```{r METADATA}
#Read in filtered SMB Genomics metadata. This file should include 92 individuals that passed filters for low genotype calls
genomics_metadata <- read_excel("../../metadata/genomics_metadata_filtered.xlsx")
genomics_metadata_pure <- read_excel("../../metadata/genomics_metadata_filtered_pure.xlsx")

#Clean metadata
genomics_metadata <- as.data.frame(genomics_metadata)
genomics_metadata <- column_to_rownames(genomics_metadata, "na")

#Below I have created an alterate dataset in excel that only includes samples that were determined to be unadmixed based on results from ADMIXTURE. This dataset was used to re-analyze population structure for only these pure samples.

genomics_metadata_pure <- as.data.frame(genomics_metadata_pure)
genomics_metadata_pure <- column_to_rownames(genomics_metadata_pure, "na")

#Filter data file for only Smallmouth Bass and INCLUDING the SMB X SPB (Spotted Bass) hybrid (BFC10)
genomics_metadata_hybrid_smb <- genomics_metadata %>%
   filter(species != "Spotted Bass")

genomics_metadata_hybrid_neosho <- genomics_metadata_hybrid_smb %>%
   filter(species != "Northern")

genomics_metadata_hybrid_northern <- genomics_metadata_hybrid_smb %>%
   filter(species != "Neosho")

#Filter data file for only Smallmouth Bass and EXCLUDING the SMB X SPB (Spotted Bass) hybrid (BFC10)
genomics_metadata_nohybrid_all <- genomics_metadata %>%
   filter(sample_id != "BFC10")

genomics_metadata_nohybrid_smb <- genomics_metadata %>% 
   filter(species != "Spotted Bass") %>% filter(sample_id != "BFC10") #EXCLUDE THE HYBRID BFC10

#Filter data file for only Neosho Smallmouth Bass
genomics_metadata_nohybrid_neosho <- genomics_metadata_nohybrid_smb %>% 
   filter(species != "Northern")

genomics_metadata_nohybrid_northern <- genomics_metadata_nohybrid_smb %>%
   filter(species != "Neosho")

#Filter PURE samples data file for only Smallmouth Bass (Northern and Neosho) that are pure
genomics_metadata_pure_smb <- genomics_metadata_pure %>%
   filter(species != "Spotted Bass")

#Filter full dataset for just admixed individuals
genomics_metadata_admixed <- genomics_metadata %>%
   filter(adm_status == "admixed") %>%
   filter(sample_id != "BFC10")

```

# Hybrid Screen Analysis
### All visualization done using the library "pophelper"

## Screen for Species-level hybridization between Smallmouth Bass and Spotted Bass as well as admixture between Northern Smallmouth Bass and Neosho Smallmouth Bass
```{r}
#Read-in ADMIXTURE q-value results for all samples at best K value (best K = 4)
admix_spb_screen <- readQ("../ADMIXTURE_analysis/admix_all_samples/pass2_all/pass2_all.4.Q") # K=4 was the best supported value of K at CV = 0.253

#Plot ADMIXTURE results for K = 4 for all samples (92) to screen for spotted bass and smallmouth bass hybrids. Any hybrids will be removed from downstream analysis

##In order of POPULATION IDs (see pop_num column of metadata)
plotQ(admix_spb_screen,
      showindlab = T, 
      useindlab=T,
      indlabsize = 8,
      indlabcol = "black",
      grplab = genomics_metadata,
      showgrplab = F,
      ordergrp = T,
      selgrp = "sample_id",
      subsetgrp =  c("SPRMO49","GRSPB52","GRSPB51","GLVR11","STOCK03","STOCK04","STOCK05","STOCK06","BP01","BP02","BP07","BP10","BP17","TBLR01","TBLR02","TBLR03","TBLR04","GRSPB35","GRSPB36","GRSPB37","GRSPB39","GRSPB41","GRSPB50","SKIA03","SKIA04","SKIA05","SKIA06","SKIA09","BC01","BC07","BC08","BC09","BC12","BC14","SC06","SC37","MI419","MI420","MI421","MI422","MI423","MI425","ER17","ER20","ER30","ER33","ER35","ER44","HC38","HC40","HC41","HC42","HC43","HC44","SPVW11","SPVW02","SPVW05","SPVW07","SPVW12","SPVW14","NOIS07","NOIS08","NOIS12","NOIS18","GLVR4","SPRMO11","SPRMO19","BFORK02","BFORK23","BFORK24","BFORK30","BFORK49","GRSPB02","GRSPB03","GRSPB69","CANEY15","CANEY16","BFC02","BFC06","BFC10","BFC49","AR16","AR18","AR19","AR21","AR29","AR30","AT02","AT05","AT08","AT09","AT12"),
      clustercol = c("forestgreen","goldenrod3","deepskyblue","deeppink2"),
      showlegend = F,
      legendmargin = c(2,2,2,2),
      showsp = F, 
      showdiv = T, 
      divsize = 0.5, 
      divcol = "black",  
      divtype = 1,
      legendkeysize = 10, 
      legendtextsize = 15, 
      linesize = 0.5, 
      pointsize = 4, 
      barbordercolour = "black",
      barbordersize = 0.2, 
      outputfilename = "../../visualization/Admixture/SPB_X_SMB_screen",
      imgtype = "pdf",
      imgoutput = "sep",
      height = 5, width = 30)
```

# Determine Major Lineages (Run only pure samples, no hybridization or admixture)

## All black bass pure samples (SPB, SMB)
```{r}

all_pure_3 <- readQ("../ADMIXTURE_analysis/admix_all_samples/pass2_pure/all_pure.3.Q") # K=3 was the best supported value of K at CV = 0.275

plotQ(all_pure_3,
      showindlab = T, 
      useindlab=T,
      indlabsize = 8,
      indlabcol = "black",
      grplab = genomics_metadata_pure,
      showgrplab = F,
      ordergrp = T,
      selgrp = "sample_id",
      subsetgrp =  c("GLVR11","GRSPB52","SPRMO49","GRSPB51","GRSPB41","GRSPB37","GRSPB39","GRSPB35","GRSPB36","TBLR02","TBLR03","TBLR04","TBLR01","GRSPB50","SKIA05","SKIA03","SKIA06","SKIA09","SKIA04","STOCK03","STOCK04","STOCK06","STOCK05","BP07","BP17","BP10","BP01","BP02","HC40","HC43","HC44","SC37","SC06","HC38","HC42","HC41","BFORK02","CANEY16","GRSPB69","NOIS12","GRSPB02","GRSPB03","BFORK49","BFORK23","BFC06","BFC49","BFC02","AR18","AR21","AR19","AR16"),
      clustercol = c("deeppink2","goldenrod3","deepskyblue"),
      showlegend = F,
      legendmargin = c(2,2,2,2),
      showsp = F, 
      showdiv = T, 
      divsize = 0.5, 
      divcol = "black",  
      divtype = 1,
      legendkeysize = 10, 
      legendtextsize = 15, 
      linesize = 0.5, 
      pointsize = 4, 
      barbordercolour = "black",
      barbordersize = 0.2, 
      outputfilename = "../../visualization/Admixture/pure_lineages_3",
      imgtype = "pdf",
      imgoutput = "sep",
      height = 5, width = 30)

#Make an admixture plot with 3 clusters, but in the order of snphylo results.
plotQ(all_pure_3,
      showindlab = T, 
      useindlab=T,
      indlabsize = 8,
      indlabcol = "black",
      grplab = genomics_metadata_pure,
      showgrplab = F,
      ordergrp = T,
      selgrp = "sample_id",
      subsetgrp =  c("GRSPB51","GRSPB52","SPRMO49","GLVR11","TBLR02","TBLR04","TBLR01","TBLR03","GRSPB37","GRSPB41","GRSPB39","GRSPB50","GRSPB35","GRSPB36","STOCK04","STOCK03","STOCK06","STOCK05","BP01","BP02","BP07","BP10","BP17","SKIA04","SKIA09","SKIA03","SKIA06","SKIA05","SC37","SC06","HC43","HC40","HC38","HC41","HC44","HC42","BFORK23","CANEY16","GRSPB69","BFORK02","GRSPB02","GRSPB03","BFORK49","NOIS12","BFC06","BFC49","BFC02","AR18","AR19","AR21","AR16"),
      clustercol = c("deeppink2","goldenrod3","deepskyblue"),
      showlegend = F,
      legendmargin = c(2,2,2,2),
      showsp = F, 
      showdiv = T, 
      divsize = 0.5, 
      divcol = "black",  
      divtype = 1,
      legendkeysize = 10, 
      legendtextsize = 15, 
      linesize = 0.5, 
      pointsize = 4, 
      barbordercolour = "black",
      barbordersize = 0.2, 
      outputfilename = "../../visualization/Admixture/pure_lineages_3_snphylo_order",
      imgtype = "pdf",
      imgoutput = "sep",
      height = 5, width = 30)

all_pure_4 <- readQ("../ADMIXTURE_analysis/admix_all_samples/pass2_pure/all_pure.4.Q") # K=4 was the second best supported value of K at CV = 0.276

plotQ(all_pure_4,
      showindlab = T, 
      useindlab=T,
      indlabsize = 8,
      indlabcol = "black",
      grplab = genomics_metadata_pure,
      showgrplab = F,
      ordergrp = T,
      selgrp = "sample_id",
      subsetgrp =  c("GRSPB51","GRSPB52","GLVR11","SPRMO49","GRSPB36","GRSPB35","GRSPB50","GRSPB41","GRSPB39","GRSPB37","TBLR03","TBLR01","TBLR02","TBLR04","SKIA05","SKIA06","SKIA03","SKIA09","SKIA04","BP17","BP02","BP01","BP07","BP10","STOCK05","STOCK06","STOCK04","STOCK03","HC38","HC41","HC44","HC42","HC40","HC43","SC37","SC06","GRSPB69","BFORK02","BFORK23","CANEY16","BFORK49","GRSPB02","GRSPB03","NOIS12","BFC02","BFC06","BFC49","AR18","AR19","AR21","AR16"),
      clustercol = c("goldenrod3","deeppink2","deepskyblue","navyblue"),
      showlegend = F,
      legendmargin = c(2,2,2,2),
      showsp = F, 
      showdiv = T, 
      divsize = 0.5, 
      divcol = "black",  
      divtype = 1,
      legendkeysize = 10, 
      legendtextsize = 15, 
      linesize = 0.5, 
      pointsize = 4, 
      barbordercolour = "black",
      barbordersize = 0.2, 
      outputfilename = "../../visualization/Admixture/pure_lineages_4",
      imgtype = "pdf",
      imgoutput = "sep",
      height = 5, width = 30)

#Make an admixture plot with 4 clusters, but in the order of snphylo results.
plotQ(all_pure_4,
      showindlab = T, 
      useindlab=T,
      indlabsize = 8,
      indlabcol = "black",
      grplab = genomics_metadata_pure,
      showgrplab = F,
      ordergrp = T,
      selgrp = "sample_id",
      subsetgrp =  c("GRSPB51","GRSPB52","SPRMO49","GLVR11","TBLR02","TBLR04","TBLR01","TBLR03","GRSPB37","GRSPB41","GRSPB39","GRSPB50","GRSPB35","GRSPB36","STOCK04","STOCK03","STOCK06","STOCK05","BP01","BP02","BP07","BP10","BP17","SKIA04","SKIA09","SKIA03","SKIA06","SKIA05","SC37","SC06","HC43","HC40","HC38","HC41","HC44","HC42","BFORK23","CANEY16","GRSPB69","BFORK02","GRSPB02","GRSPB03","BFORK49","NOIS12","BFC06","BFC49","BFC02","AR18","AR19","AR21","AR16"),
      clustercol = c("goldenrod3","deeppink2","deepskyblue","navyblue"),
      showlegend = F,
      legendmargin = c(2,2,2,2),
      showsp = F, 
      showdiv = T, 
      divsize = 0.5, 
      divcol = "black",  
      divtype = 1,
      legendkeysize = 10, 
      legendtextsize = 15, 
      linesize = 0.5, 
      pointsize = 4, 
      barbordercolour = "black",
      barbordersize = 0.2, 
      outputfilename = "../../visualization/Admixture/pure_lineages_4_snphylo_order",
      imgtype = "pdf",
      imgoutput = "sep",
      height = 5, width = 30)

all_pure_5 <- readQ("../ADMIXTURE_analysis/admix_all_samples/pass2_pure/all_pure.5.Q") # K=5 was close to K=3 and K=4, at CV = 0.283

plotQ(all_pure_5,
      showindlab = T, 
      useindlab=T,
      indlabsize = 8,
      indlabcol = "black",
      grplab = genomics_metadata_pure,
      showgrplab = F,
      ordergrp = T,
      selgrp = "sample_id",
      subsetgrp =  c("GRSPB51","GRSPB52","GLVR11","SPRMO49","GRSPB36","GRSPB35","GRSPB50","GRSPB41","GRSPB39","GRSPB37","TBLR03","TBLR01","TBLR02","TBLR04","SKIA05","SKIA06","SKIA03","SKIA09","SKIA04","BP17","BP02","BP01","BP07","BP10","STOCK05","STOCK06","STOCK04","STOCK03","HC38","HC41","HC44","HC42","HC40","HC43","SC37","SC06","GRSPB69","BFORK02","BFORK23","CANEY16","BFORK49","GRSPB02","GRSPB03","NOIS12","BFC02","BFC06","BFC49","AR18","AR19","AR21","AR16"),
      clustercol = c("deeppink2","goldenrod3","forestgreen","deepskyblue","navyblue"),
      showlegend = F,
      legendmargin = c(2,2,2,2),
      showsp = F, 
      showdiv = T, 
      divsize = 0.5, 
      divcol = "black",  
      divtype = 1,
      legendkeysize = 10, 
      legendtextsize = 15, 
      linesize = 0.5, 
      pointsize = 4, 
      barbordercolour = "black",
      barbordersize = 0.2, 
      outputfilename = "../../visualization/Admixture/pure_lineages_5",
      imgtype = "pdf",
      imgoutput = "sep",
      height = 5, width = 30)

#Make an admixture plot with 5 clusters, but in the order of snphylo results.
plotQ(all_pure_5,
      showindlab = T, 
      useindlab=T,
      indlabsize = 8,
      indlabcol = "black",
      grplab = genomics_metadata_pure,
      showgrplab = F,
      ordergrp = T,
      selgrp = "sample_id",
      subsetgrp =  c("GRSPB51","GRSPB52","SPRMO49","GLVR11","TBLR02","TBLR04","TBLR01","TBLR03","GRSPB37","GRSPB41","GRSPB39","GRSPB50","GRSPB35","GRSPB36","STOCK04","STOCK03","STOCK06","STOCK05","BP01","BP02","BP07","BP10","BP17","SKIA04","SKIA09","SKIA03","SKIA06","SKIA05","SC37","SC06","HC43","HC40","HC38","HC41","HC44","HC42","BFORK23","CANEY16","GRSPB69","BFORK02","GRSPB02","GRSPB03","BFORK49","NOIS12","BFC06","BFC49","BFC02","AR18","AR19","AR21","AR16"),
      clustercol = c("deeppink2","goldenrod3","forestgreen","deepskyblue","navyblue"),
      showlegend = F,
      legendmargin = c(2,2,2,2),
      showsp = F, 
      showdiv = T, 
      divsize = 0.5, 
      divcol = "black",  
      divtype = 1,
      legendkeysize = 10, 
      legendtextsize = 15, 
      linesize = 0.5, 
      pointsize = 4, 
      barbordercolour = "black",
      barbordersize = 0.2, 
      outputfilename = "../../visualization/Admixture/pure_lineages_5_snphylo_order",
      imgtype = "pdf",
      imgoutput = "sep",
      height = 5, width = 30)
```

## Only Northern and Neosho Smallmouth Bass samples (SMB)
```{r}
smb_pure_3 <- readQ("../ADMIXTURE_analysis/admix_all_samples/pass2_pure/smb_pure.3.Q") # K=3 was the best supported value of K at CV = 0.276

plotQ(smb_pure_3,
      showindlab = T, 
      useindlab=T,
      indlabsize = 8,
      indlabcol = "black",
      grplab = genomics_metadata_pure_smb,
      showgrplab = F,
      ordergrp = T,
      selgrp = "sample_id",
      subsetgrp =  c("GRSPB41","GRSPB37","GRSPB39","GRSPB35","GRSPB36","TBLR02","TBLR03","TBLR04","TBLR01","GRSPB50","SKIA05","SKIA03","SKIA06","SKIA09","SKIA04","STOCK03","STOCK04","STOCK06","STOCK05","BP07","BP17","BP10","BP01","BP02","HC40","HC43","HC44","SC37","SC06","HC38","HC42","HC41","BFORK02","CANEY16","GRSPB69","NOIS12","GRSPB02","GRSPB03","BFORK49","BFORK23","BFC06","BFC49","BFC02","AR18","AR21","AR19","AR16"),
      clustercol = c("deeppink2","deepskyblue","navyblue"),
      showlegend = F,
      legendmargin = c(2,2,2,2),
      showsp = F, 
      showdiv = T, 
      divsize = 0.5, 
      divcol = "black",  
      divtype = 1,
      legendkeysize = 10, 
      legendtextsize = 15, 
      linesize = 0.5, 
      pointsize = 4, 
      barbordercolour = "black",
      barbordersize = 0.2, 
      outputfilename = "../../visualization/Admixture/smb_pure_lineages_3",
      imgtype = "pdf",
      imgoutput = "sep",
      height = 5, width = 30)
```

# Determine if there is any population structure among the admixed individuals (within Neosho Smallmouth Bass)
## Only Northern and Neosho Smallmouth Bass samples (SMB)

```{r}
admixed_2 <- readQ("../ADMIXTURE_analysis/admix_all_samples/pass2_admixed/admixed_indivs.2.Q") # K=3 was the best supported value of K at CV = 0.276

plotQ(admixed_2,
      showindlab = T, 
      useindlab=T,
      indlabsize = 8,
      indlabcol = "black",
      grplab = genomics_metadata_admixed,
      showgrplab = F,
      ordergrp = T,
      selgrp = "sample_id",
      subsetgrp =  c("NOIS18","NOIS08","NOIS07","BFORK30","BFORK24","SPRMO11","GLVR4","SPRMO19","CANEY15","AT12","AT05","AT08","AT09","AT02","AR29","AR30","ER33","ER35","ER20","ER30","ER44","ER17","BC01","BC08","BC09","BC12","SPVW14","SPVW07","MI422","MI421","SPVW02","SPVW05","SPVW11","MI420","MI423","BC07","SPVW12","BC14","MI425","MI419"),
      clustercol = c("mediumpurple","orchid1"),
      showlegend = F,
      legendmargin = c(2,2,2,2),
      showsp = F, 
      showdiv = T, 
      divsize = 0.5, 
      divcol = "black",  
      divtype = 1,
      legendkeysize = 10, 
      legendtextsize = 15, 
      linesize = 0.5, 
      pointsize = 4, 
      barbordercolour = "black",
      barbordersize = 0.2, 
      outputfilename = "../../visualization/Admixture/neosho_admixed_lineages_2",
      imgtype = "pdf",
      imgoutput = "sep",
      height = 5, width = 30)

admixed_3 <- readQ("../ADMIXTURE_analysis/admix_all_samples/pass2_admixed/admixed_indivs.3.Q") # K=3 was the best supported value of K at CV = 0.276

plotQ(admixed_3,
      showindlab = T, 
      useindlab=T,
      indlabsize = 8,
      indlabcol = "black",
      grplab = genomics_metadata_admixed,
      showgrplab = F,
      ordergrp = T,
      selgrp = "sample_id",
      subsetgrp =  c("NOIS18","NOIS08","NOIS07","BFORK30","BFORK24","SPRMO11","GLVR4","SPRMO19","CANEY15","AT12","AT05","AT08","AT09","AT02","AR29","AR30","ER33","ER35","ER20","ER30","ER44","ER17","BC01","BC08","BC09","BC12","SPVW14","SPVW07","MI422","MI421","SPVW02","SPVW05","SPVW11","MI420","MI423","BC07","SPVW12","BC14","MI425","MI419"),
      clustercol = c("lightgreen","mediumpurple","orchid1"),
      showlegend = F,
      legendmargin = c(2,2,2,2),
      showsp = F, 
      showdiv = T, 
      divsize = 0.5, 
      divcol = "black",  
      divtype = 1,
      legendkeysize = 10, 
      legendtextsize = 15, 
      linesize = 0.5, 
      pointsize = 4, 
      barbordercolour = "black",
      barbordersize = 0.2, 
      outputfilename = "../../visualization/Admixture/neosho_admixed_lineages_3",
      imgtype = "pdf",
      imgoutput = "sep",
      height = 5, width = 30)

admixed_4 <- readQ("../ADMIXTURE_analysis/admix_all_samples/pass2_admixed/admixed_indivs.4.Q") # K=3 was the best supported value of K at CV = 0.276

plotQ(admixed_4,
      showindlab = T, 
      useindlab=T,
      indlabsize = 8,
      indlabcol = "black",
      grplab = genomics_metadata_admixed,
      showgrplab = F,
      ordergrp = T,
      selgrp = "sample_id",
      subsetgrp =  c("NOIS18","NOIS08","NOIS07","BFORK30","BFORK24","SPRMO11","GLVR4","SPRMO19","CANEY15","AT12","AT05","AT08","AT09","AT02","AR29","AR30","ER33","ER35","ER20","ER30","ER44","ER17","BC01","BC08","BC09","BC12","SPVW14","SPVW07","MI422","MI421","SPVW02","SPVW05","SPVW11","MI420","MI423","BC07","SPVW12","BC14","MI425","MI419"),
      clustercol = c("lightgreen","orchid1","mediumpurple", "sienna4"),
      showlegend = F,
      legendmargin = c(2,2,2,2),
      showsp = F, 
      showdiv = T, 
      divsize = 0.5, 
      divcol = "black",  
      divtype = 1,
      legendkeysize = 10, 
      legendtextsize = 15, 
      linesize = 0.5, 
      pointsize = 4, 
      barbordercolour = "black",
      barbordersize = 0.2, 
      outputfilename = "../../visualization/Admixture/neosho_admixed_lineages_4",
      imgtype = "pdf",
      imgoutput = "sep",
      height = 5, width = 30)
```

# CV Error
###All analyses were conducted in base R

## Cross-validation (10-fold) error results for ADMIXTURE analyses
```{r}
#For each admixture analysis that I ran, I conducted a 10-fold cross validation to obtain error values for each value of K. The K value with the lowest cross-validation error is the K that is most likely given the data. Here I am graphing the cross-validation error values across all K for each analysis (hierarchical analysis for all samples, INCLUDING the hybrid, and hierarchial analysis for all samples, EXCLUDING the hybrid)

#Read in data for all samples INCLUDING the Hybrid (BFC10)
cv_all_withhybrids <- read_excel("../ADMIXTURE_analysis/cv_all_samples/cv_all_samples_all_filters_withhybrids.xlsx")
cv_smb_withhybrids <- read_excel("../ADMIXTURE_analysis/cv_all_samples/cv_smb_all_filters_withhybrids.xlsx")
cv_neosho_withhybrids <- read_excel("../ADMIXTURE_analysis/cv_all_samples/cv_neosho_all_filters_withhybrids.xlsx")
cv_northern_withhybrids <- read_excel("../ADMIXTURE_analysis/cv_all_samples/cv_northern_all_filters_withhybrids.xlsx")
cv_all_pure <- read_excel("../ADMIXTURE_analysis/cv_all_samples/cv_all_pure.xlsx")
cv_admixed <- read_excel("../ADMIXTURE_analysis/cv_all_samples/cv_admixed_indivs.xlsx")

#Clean data for all samples, including the hybrid
cv_all_withhybrids <- as.data.frame(cv_all_withhybrids)
cv_smb_withhybrids <- as.data.frame(cv_smb_withhybrids)
cv_neosho_withhybrids <- as.data.frame(cv_neosho_withhybrids)
cv_northern_withhybrids <- as.data.frame(cv_northern_withhybrids)
cv_all_pure <- as.data.frame(cv_all_pure)

#Read in data for all samples EXCLUDING the Hybrid (BFC10)
cv_all_nohybrids <- read_excel("../ADMIXTURE_analysis/cv_all_samples_noBFC10/cv_all_samples_all_filters_NOhybrids.xlsx")
cv_smb_nohybrids <- read_excel("../ADMIXTURE_analysis/cv_all_samples_noBFC10/cv_smb_all_filters_NOhybrids.xlsx")
cv_neosho_nohybrids <- read_excel("../ADMIXTURE_analysis/cv_all_samples_noBFC10/cv_neosho_all_filters_NOhybrids.xlsx")
cv_northern_nohybrids <- read_excel("../ADMIXTURE_analysis/cv_all_samples_noBFC10/cv_northern_all_filters_NOhybrids.xlsx")

#Clean data for all samples, excluding the hybrid
cv_all_nohybrids <- as.data.frame(cv_all_nohybrids)
cv_smb_nohybrids <- as.data.frame(cv_smb_nohybrids)
cv_neosho_nohybrids <- as.data.frame(cv_neosho_nohybrids)
cv_northern_nohybrids <- as.data.frame(cv_northern_nohybrids)

###CV ERROR PLOTS####

###CV ERROR PLOTS FOR ALL SAMPLES, INCLUDING HYBRIDS####

#cv error plot for all samples
cv_all_withhybrids_plot <- ggplot(cv_all_withhybrids, aes(x = k, y = cv)) + 
   geom_point(size = 3) + 
   geom_path(stat = "identity", size = 1) + 
   scale_x_continuous("K", labels = as.character(cv_all_withhybrids$k), breaks = cv_all_withhybrids$k) + 
   labs(x = "K", y = "10-Fold CV Error") + 
   theme_set(theme_cowplot()) + 
   theme(axis.text = element_text(size = 20)) + 
   theme(axis.title.x = element_text(face = "italic")) + 
   theme(axis.title = element_text(size = 20)) +
   theme(axis.title.x = element_blank())

#cv error for SMB samples only
cv_smb_withhybrids_plot <- ggplot(cv_smb_withhybrids, aes(x = k, y = cv)) + 
   geom_point(size = 3) + 
   geom_path(stat = "identity", size = 1) + 
   scale_x_continuous("K", labels = as.character(cv_smb_withhybrids$k), breaks = cv_smb_withhybrids$k) + 
   labs(x = "K", y = "10-Fold CV Error") + 
   theme_set(theme_cowplot()) + 
   theme(axis.text = element_text(size = 20)) + 
   theme(axis.title.x = element_text(face = "italic")) +
   theme(axis.title = element_text(size = 20)) +
   theme(axis.title.x = element_blank())

#cv error for NEOSHO (NEO) samples only
cv_neosho_withhybrids_plot <- ggplot(cv_neosho_withhybrids, aes(x = k, y = cv)) + 
   geom_point(size = 3) + 
   geom_path(stat = "identity", size = 1) + 
   scale_x_continuous("K", labels = as.character(cv_neosho_withhybrids$k), breaks = cv_neosho_withhybrids$k) + 
   labs(x = "K", y = "10-Fold CV Error") + 
   theme_set(theme_cowplot()) + 
   theme(axis.text = element_text(size = 20)) + 
   theme(axis.title.x = element_text(face = "italic")) + 
   theme(axis.title = element_text(size = 20)) +
   theme(axis.title.x = element_blank())

#cv error for NORTHERN (NOR) samples only
cv_northern_withhybrids_plot <- ggplot(cv_northern_withhybrids, aes(x = k, y = cv)) +
   geom_point(size = 3) + 
   geom_path(stat = "identity", size = 1) + 
   scale_x_continuous("K", labels = as.character(cv_northern_withhybrids$k), breaks = cv_northern_withhybrids$k) + 
   labs(x = "K", y = "10-Fold CV Error") + 
   theme_set(theme_cowplot()) + 
   theme(axis.text = element_text(size = 20)) + 
   theme(axis.title.x = element_text(face = "italic")) +
   theme(axis.title = element_text(size = 20))

#cv error plot for all samples, but ONLY PURE SAMPLES
cv_all_pure_plot <- ggplot(cv_all_pure, aes(x = k, y = cv_error)) + 
   geom_point(size = 3) + 
   geom_path(stat = "identity", size = 1) + 
   scale_x_continuous("K", labels = as.character(cv_all_pure$k), breaks = cv_all_pure$k) + 
   labs(x = "K", y = "10-Fold CV Error") + 
   theme_set(theme_cowplot()) + 
   theme(axis.text = element_text(size = 20)) + 
   theme(axis.title.x = element_text(face = "italic")) + 
   theme(axis.title = element_text(size = 20)) +
   theme(axis.title.x = element_blank())

###CV ERROR PLOTS FOR ALL SAMPLES, EXCLUDING HYBRIDS####

#cv error plot for all samples, NO HYBRIDS
cv_all_nohybrids_plot <- ggplot(cv_all_nohybrids, aes(x = k, y = cv)) + 
   geom_point(size = 3) + 
   geom_path(stat = "identity", size = 1) + 
   scale_x_continuous("K", labels = as.character(cv_all_nohybrids$k), breaks = cv_all_nohybrids$k) + 
   labs(x = "K", y = "10-Fold CV Error") + 
   theme_set(theme_cowplot()) + 
   theme(axis.text = element_text(size = 20)) + 
   theme(axis.title.x = element_text(face = "italic")) +
   theme(axis.title = element_text(size = 20)) +
   theme(axis.title = element_blank())

#cv error for SMB samples only, NO HYBRIDS
cv_smb_nohybrids_plot <- ggplot(cv_smb_nohybrids, aes(x = k, y = cv)) + 
   geom_point(size = 3) + 
   geom_path(stat = "identity", size = 1) + 
   scale_x_continuous("K", labels = as.character(cv_smb_nohybrids$k), breaks = cv_smb_nohybrids$k) + 
   labs(x = "K", y = "10-Fold CV Error") + 
   theme_set(theme_cowplot()) + 
   theme(axis.text = element_text(size = 20)) + 
   theme(axis.title.x = element_text(face = "italic")) +
   theme(axis.title = element_text(size = 20)) +
   theme(axis.title = element_blank())

#cv error for NEOSHO (NEO) samples only, NO HYBRIDS
cv_neosho_nohybrids_plot <- ggplot(cv_neosho_nohybrids, aes(x = k, y = cv)) + 
   geom_point(size = 3) + 
   geom_path(stat = "identity", size = 1) + 
   scale_x_continuous("K", labels = as.character(cv_neosho_nohybrids$k), breaks = cv_neosho_nohybrids$k) + 
   labs(x = "K", y = "10-Fold CV Error") + 
   theme_set(theme_cowplot()) + 
   theme(axis.text = element_text(size = 20)) + 
   theme(axis.title.x = element_text(face = "italic")) + 
   theme(axis.title = element_text(size = 20)) +
   theme(axis.title = element_blank())

#cv error for NORTHERN (NOR) samples only, NO HYBRIDS
cv_northern_nohybrids_plot <- ggplot(cv_northern_nohybrids, aes(x = k, y = cv)) +
   geom_point(size = 3) + 
   geom_path(stat = "identity", size = 1) + 
   scale_x_continuous("K", labels = as.character(cv_northern_nohybrids$k), breaks = cv_northern_nohybrids$k) + 
   labs(x = "K", y = "10-Fold CV Error") + 
   theme_set(theme_cowplot()) + 
   theme(axis.text = element_text(size = 20)) + 
   theme(axis.title.x = element_text(face = "italic")) +
   theme(axis.title = element_text(size = 20)) +
   theme(axis.title.y = element_blank())


###Combine CV Error Plots into two columns, column 1 with hybrids, column 2 without hybrids
cv_withhybrids_combined <- plot_grid(cv_all_withhybrids_plot, cv_smb_withhybrids_plot, cv_neosho_withhybrids_plot, cv_northern_withhybrids_plot, nrow = 4, ncol =1, labels = c("a","b","c","d"), label_size = 25, label_y = 1.04)

cv_nohybrids_combined <- plot_grid(cv_all_nohybrids_plot, cv_smb_nohybrids_plot, cv_neosho_nohybrids_plot, cv_northern_nohybrids_plot, nrow = 4, ncol =1, labels = c("e","f","g","h"), label_size = 25, label_y = 1.04)


###Combine CV plots for all samples, both with and without hybrids, into a single figure
pdf("/Users/joegunn/Desktop/Grad_School_Stuff/Research/Projects/Smallmouth_Bass_Genomics/visualization/Admixture/cv_error_plot.pdf", width=16, height=20) 

plot_grid(cv_withhybrids_combined, cv_nohybrids_combined, ncol = 2)

dev.off()

#CV PLOT for PURE SAMPLES

pdf("/Users/joegunn/Desktop/Grad_School_Stuff/Research/Projects/Smallmouth_Bass_Genomics/visualization/Admixture/cv_error_plot_all_pure_samples.pdf", width=8, height=4) 

ggplot(cv_all_pure, aes(x = k, y = cv_error)) + 
   geom_point(size = 3) + 
   geom_path(stat = "identity", size = 1) + 
   scale_x_continuous("K", labels = as.character(cv_all_pure$k), breaks = cv_all_pure$k) + 
   labs(x = "K", y = "10-Fold CV Error") + 
   theme_set(theme_cowplot()) + 
   theme(axis.text = element_text(size = 20)) + 
   theme(axis.title.x = element_text(face = "italic")) + 
   theme(axis.title = element_text(size = 20))

dev.off()

pdf("/Users/joegunn/Desktop/Grad_School_Stuff/Research/Projects/Smallmouth_Bass_Genomics/visualization/Admixture/cv_error_plot_admixed_indivs.pdf", width=5, height=4) 

ggplot(cv_admixed, aes(x = k, y = cv)) + 
   geom_point(size = 3) + 
   geom_path(stat = "identity", size = 1) + 
   scale_x_continuous("K", labels = as.character(cv_admixed$k), breaks = cv_admixed$k) + 
   labs(x = "K", y = "10-Fold CV Error") + 
   theme_set(theme_cowplot()) + 
   theme(axis.text = element_text(size = 20)) + 
   theme(axis.title.x = element_text(face = "italic")) + 
   theme(axis.title = element_text(size = 20))

dev.off()
```
